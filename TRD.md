# Technical Requirements Document (TRD)
## AI Sage Content Generator MVP

### 1. 프로젝트 개요

**프로젝트명:** AI Sage Content Generator

**목적:** 다양한 AI 페르소나(워렌 버핏, 일론 머스크, 레이 달리오 등)들이 특정 주제에 대해 대화를 나누고, 그 대화 내용을 바탕으로 뉴욕타임즈 스타일의 기사를 자동 생성하는 시스템

**대상 사용자:** 콘텐츠 크리에이터, 마케터, 리서처

---

### 2. 핵심 기능 요구사항

#### 2.1 페르소나 관리
- **FR-1.1:** 시스템은 JSON 파일에서 AI 페르소나 정의를 로드할 수 있어야 함
- **FR-1.2:** 각 페르소나는 이름, instruction, 색상 코드를 포함해야 함
- **FR-1.3:** 사용자는 대화에 참여할 페르소나를 선택할 수 있어야 함
- **FR-1.4:** 최소 1명 이상의 페르소나가 선택되어야 함

#### 2.2 주제 입력
- **FR-2.1:** 시스템은 3가지 주제 입력 방식을 지원해야 함:
  - 직접 입력
  - URL에서 추출
  - 자동 주제 선택
- **FR-2.2:** URL 입력 시 웹페이지 제목을 크롤링하여 주제로 사용
- **FR-2.3:** 주제 추출 실패 시 기본 주제 제공

#### 2.3 대화 생성
- **FR-3.1:** LangGraph를 사용한 상태 기반 대화 플로우 구현
- **FR-3.2:** 선택된 페르소나들이 순차적으로 대화에 참여
- **FR-3.3:** 최소 5개 메시지 또는 $50 비용 도달 시 대화 종료
- **FR-3.4:** 실시간으로 대화 진행상황 표시

#### 2.4 콘텐츠 생성
- **FR-4.1:** 대화 내용을 뉴욕타임즈 스타일 기사로 변환
- **FR-4.2:** 기사 메타데이터 자동 생성 (제목, 부제목, 설명, 슬러그)
- **FR-4.3:** 대화 요약 기능

#### 2.5 비용 추적
- **FR-5.1:** 토큰 사용량 실시간 계산
- **FR-5.2:** API 호출 비용 계산 및 표시
- **FR-5.3:** 입력/출력 토큰 별도 추적

#### 2.6 Notion 통합 (선택적)
- **FR-6.1:** Notion API를 통한 결과 저장 (선택적)
- **FR-6.2:** Notion 설정이 없어도 시스템 정상 작동
- **FR-6.3:** 저장 성공 시 Notion 페이지 URL 반환

---

### 3. 기술 스택

#### 3.1 프로그래밍 언어
- Python 3.8+

#### 3.2 핵심 라이브러리
| 라이브러리 | 버전 | 용도 |
|-----------|------|------|
| streamlit | latest | 웹 UI 프레임워크 |
| langchain | 0.1.0+ | LLM 애플리케이션 프레임워크 |
| langgraph | 0.0.10+ | 그래프 기반 대화 플로우 |
| langchain-anthropic | 0.0.10+ | Claude API 통합 |
| anthropic | 0.8.1+ | Anthropic SDK |
| pydantic | 2.5.2+ | 데이터 검증 |
| tiktoken | 0.5.1+ | 토큰 계산 |
| requests | 2.31.0+ | HTTP 요청 |
| beautifulsoup4 | 4.12.2+ | 웹 크롤링 |
| python-dotenv | 1.0.0+ | 환경 변수 관리 |
| notion-client | latest | Notion API (선택적) |

#### 3.3 외부 API
- **Anthropic Claude API:** Claude 3.5 Sonnet 모델 사용
- **Notion API:** 선택적 통합

---

### 4. 아키텍처 설계

#### 4.1 시스템 구성요소

```
┌─────────────────────────────────────────┐
│         Streamlit Web UI (app.py)       │
│  ┌──────────────────────────────────┐   │
│  │  Persona Selection               │   │
│  │  Topic Input                     │   │
│  │  Progress Display                │   │
│  └──────────────────────────────────┘   │
└─────────────┬───────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│      Core Logic (main.py modules)       │
│  ┌──────────────────────────────────┐   │
│  │  ConversationState               │   │
│  │  AISage                          │   │
│  │  Workflow Management             │   │
│  └──────────────────────────────────┘   │
└─────────────┬───────────────────────────┘
              │
    ┌─────────┴─────────┬─────────────┐
    ▼                   ▼             ▼
┌─────────┐      ┌────────────┐  ┌──────────┐
│ Claude  │      │  Notion    │  │ Web      │
│   API   │      │    API     │  │ Scraper  │
└─────────┘      └────────────┘  └──────────┘
```

#### 4.2 데이터 흐름

1. **초기화:** 페르소나 로드 → 사용자 입력
2. **대화 생성:** 주제 설정 → 대화 시작 → 페르소나 순차 발언
3. **콘텐츠 생성:** 대화 요약 → 기사 생성 → 메타데이터 생성
4. **저장:** Notion 저장 (선택적)

#### 4.3 상태 관리

**ConversationState:**
- topic: str (주제)
- messages: List[Dict] (대화 메시지)
- summary: str (요약)
- content: str (생성된 기사)
- input_tokens: int (입력 토큰)
- output_tokens: int (출력 토큰)
- cost: float (비용)
- title, subtitle, description, slug: str (메타데이터)
- notion_url: str (Notion 페이지 URL)

---

### 5. 비기능 요구사항

#### 5.1 성능
- **NFR-1.1:** 5개 메시지 대화 생성 시간: 60초 이내
- **NFR-1.2:** 웹 UI 응답 시간: 2초 이내

#### 5.2 신뢰성
- **NFR-2.1:** API 호출 실패 시 적절한 에러 메시지 표시
- **NFR-2.2:** Notion 저장 실패 시에도 콘텐츠는 UI에 표시

#### 5.3 보안
- **NFR-3.1:** API 키는 환경 변수로 관리
- **NFR-3.2:** .env 파일은 .gitignore에 포함
- **NFR-3.3:** 민감 정보는 로그에 출력하지 않음

#### 5.4 사용성
- **NFR-4.1:** 직관적인 웹 UI 제공
- **NFR-4.2:** 진행 상황 실시간 표시
- **NFR-4.3:** 에러 메시지는 사용자 친화적이어야 함

#### 5.5 유지보수성
- **NFR-5.1:** 코드는 PEP 8 스타일 가이드 준수
- **NFR-5.2:** 주요 함수에 docstring 포함
- **NFR-5.3:** 모듈화된 구조

---

### 6. 제약사항

#### 6.1 외부 의존성
- **C-1.1:** Anthropic API 키 필수
- **C-1.2:** 인터넷 연결 필수 (API 호출, 웹 크롤링)
- **C-1.3:** Notion 통합은 선택적

#### 6.2 비용
- **C-2.1:** Claude API 사용 시 비용 발생
- **C-2.2:** 기본 종료 조건: 5 메시지 또는 $50

#### 6.3 기술적 제약
- **C-3.1:** Python 3.8 이상 필요
- **C-3.2:** 최신 langchain/langgraph 호환성

---

### 7. 테스트 요구사항

#### 7.1 단위 테스트
- count_tokens() 함수
- calculate_cost() 함수
- get_topic() 함수
- Persona 로딩

#### 7.2 통합 테스트
- 전체 워크플로우 실행
- Notion 통합 (선택적)
- 에러 핸들링

#### 7.3 수동 테스트
- Streamlit UI 동작 확인
- 다양한 주제/페르소나 조합 테스트

---

### 8. 배포 요구사항

#### 8.1 환경 설정
- .env.example 파일 제공
- requirements.txt 정확성

#### 8.2 문서화
- README.md 업데이트
- 설치 가이드
- 사용 예시

#### 8.3 버전 관리
- Git을 통한 버전 관리
- 의미있는 커밋 메시지

---

### 9. MVP 범위

#### 9.1 포함 기능
✅ Streamlit 웹 UI
✅ 페르소나 선택
✅ 3가지 주제 입력 방식
✅ 대화 생성
✅ 기사 생성
✅ 메타데이터 생성
✅ 비용 추적
✅ Notion 통합 (선택적)

#### 9.2 제외 기능 (향후 개선)
❌ 사용자 인증
❌ 대화 히스토리 저장
❌ 다국어 지원
❌ 페르소나 동적 추가
❌ 고급 필터링/검색

---

### 10. 성공 기준

MVP는 다음 조건을 만족할 때 성공:

1. ✅ 환경 변수 설정 후 정상 실행
2. ✅ 페르소나 선택 및 대화 생성 정상 작동
3. ✅ 뉴욕타임즈 스타일 기사 생성
4. ✅ 비용 추적 정확성
5. ✅ Notion API 없이도 정상 작동
6. ✅ 기본 에러 핸들링
7. ✅ README 문서화 완료
8. ✅ 테스트 케이스 통과

---

### 11. 향후 로드맵

#### Phase 2 (Post-MVP)
- 대화 히스토리 데이터베이스 저장
- 다양한 기사 스타일 선택
- 페르소나 커스터마이징
- 다국어 지원

#### Phase 3 (Advanced)
- 사용자 인증 및 권한 관리
- 팀 협업 기능
- API 엔드포인트 제공
- 클라우드 배포

---

**문서 버전:** 1.0
**작성일:** 2025-11-19
**작성자:** Claude AI Agent
